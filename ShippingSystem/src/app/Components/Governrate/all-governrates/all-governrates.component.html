<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
<div class="governorate-container">
  <!-- Header Section -->
  <div class="governorate-header">
    <h2 class="governorate-title">Governorates</h2>
    <button class="assign-btn" (click)="isFormVisible = !isFormVisible">
      {{ isFormVisible ? 'Close Form' : 'Add Governorate' }}
    </button>
  </div>

  <!-- Form Section -->
  @if (isFormVisible) {
    <div class="governorate-form">
      <form [formGroup]="governrateForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="name">Governorate Name</label>
          <input
            formControlName="name"
            id="name"
            class="form-control"
            placeholder="Enter governorate name"
            type="text"
          />
          @if (name?.touched && name?.invalid) {
            <div class="error">Name is required (2‚Äì100 characters).</div>
          }
        </div>

        <div class="form-actions">
          <button class="assign-btn" type="submit" [disabled]="isSubmitting">
            {{ isSubmitting ? 'Adding...' : 'Add Governorate' }}
          </button>
        </div>

        @if (successMessage) {
          <div class="alert alert-success">{{ successMessage }}</div>
        }
        @if (errorMessage) {
          <div class="alert alert-danger">{{ errorMessage }}</div>
        }
      </form>
    </div>
  }

  <!-- Search Section -->
  <div class="search-box">
    <input
      [(ngModel)]="searchName"
      (ngModelChange)="onSearchChange(searchName)"
      placeholder="Search by name"
      type="text"
      class="form-control"
    />
  </div>

  <!-- Entries Count -->
  <div class="entries-info mb-3 pagination-controls">
    <span class="entries-text">Show</span>
    <select class="entries-select" [(ngModel)]="itemsPerPage" (change)="onItemsPerPageChange(itemsPerPage)">
      <option *ngFor="let size of [5, 10, 20, 50]" [value]="size">{{ size }}</option>
    </select>
    <span class="entries-text">entries</span>
  </div>

  <!-- Table Section -->
  @if (!isLoading && filteredGovernrates.length > 0) {
    <table class="table agent-table">
      <thead>
        <tr>
          <th>Governorate ID</th>
          <th>Name</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (gov of filteredGovernrates; track gov; let i = $index) {
          <tr>
            <td>{{ gov.id }}</td>
            <td>
              @if (editingId === gov.id) {
                <input
                  [(ngModel)]="gov.name"
                  class="form-control inline-edit"
                  (keyup.enter)="saveEdit(gov)"
                  (keyup.escape)="cancelEdit()"
                />
              } @else {
                {{ gov.name }}
              }
            </td>
            <td>
              <div class="action-buttons">
                @if (editingId === gov.id) {
                  <button class="assign-btn" (click)="saveEdit(gov)" title="Save">
                    ‚úì
                  </button>
                  <button class="details-btn" (click)="cancelEdit()" title="Cancel">
                    ‚úï
                  </button>
                } @else {
                  <button class="details-btn" (click)="startEdit(gov.id)" title="Edit">
                    ‚úèÔ∏è
                  </button>
                  <button class="details-btn" (click)="onDelete(gov.id)" title="Delete">
                    üóëÔ∏è
                  </button>
                }
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>
  }

  <!-- Loading State -->
  @if (isLoading) {
    <div class="loading">
      ‚è≥ Loading governorates...
    </div>
  }

  <!-- No Data State -->
  @if (!isLoading && filteredGovernrates.length === 0) {
    <div class="no-data">
      üì≠
      <p>No governorates found.</p>
      @if (searchName) {
        <p>Try adjusting your search criteria.</p>
      }
    </div>
  }

  <!-- Pagination -->
  @if (totalCount > itemsPerPage) {
    <nav class="pagination-wrapper">
      <ul class="pagination">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="onPageChange(currentPage - 1)">
            ‚Äπ
          </button>
        </li>

        @for (page of totalPages(); track page) {
          <li class="page-item" [class.active]="currentPage === page">
            <button class="page-link" (click)="onPageChange(page)">
              {{ page }}
            </button>
          </li>
        }

        <li class="page-item" [class.disabled]="currentPage === totalPages().length">
          <button class="page-link" (click)="onPageChange(currentPage + 1)">
            ‚Ä∫
          </button>
        </li>
      </ul>
    </nav>
  }
</div>
