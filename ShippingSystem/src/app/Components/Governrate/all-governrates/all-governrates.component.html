<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<div class="governorate-container">
  <!-- Toggle Button to Show/Hide Form -->
  <div class="form-toggle">
    <button class="add-btn" (click)="isFormVisible = !isFormVisible">
      {{ isFormVisible ? 'Close Form' : 'Add Governorate' }}
    </button>
  </div>

  <!-- Form Section -->
  @if (isFormVisible) {
    <div class="governorate-form">
      <form [formGroup]="governrateForm" (ngSubmit)="onSubmit()">
        <label> Name:</label>
        <input
          formControlName="name"
          placeholder="Enter governorate name"
          type="text" />
          @if (name?.touched && name?.invalid) {
            <div class="error">
              Name is required (2‚Äì100 characters).
            </div>
          }
          <button type="submit" [disabled]="isSubmitting">Add Governorate</button>
          @if (successMessage) {
            <div class="success">{{ successMessage }}</div>
          }
          @if (errorMessage) {
            <div class="error">{{ errorMessage }}</div>
          }
        </form>
      </div>
    }

    <!-- Search Section -->
    <div class="search-box">
      <input
        [(ngModel)]="searchName"
        (ngModelChange)="onSearchChange(searchName)"
        placeholder="Search by name"
        type="text" />
      </div>

      <!-- Table Section -->
      @if (!isLoading && filteredGovernrates.length > 0) {
        <table class="governorate-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (gov of filteredGovernrates; track gov; let i = $index) {
              <tr>
                <td>{{ i + 1 }}</td>
                <td>{{ gov.name }}</td>
                <td>
                  <i
                    [ngClass]="gov.isDeleted ? 'bi bi-x-circle text-danger' : 'bi bi-check-circle text-success'"
                    [title]="gov.isDeleted ? 'Inactive' : 'Active'">
                  </i>
                </td>
                <td>
                  @if (editingId === gov.id) {
                    <input [(ngModel)]="gov.name" class="inline-edit" />
                    <button (click)="saveEdit(gov)">üíæ</button>
                    <button (click)="cancelEdit()">‚ùå</button>
                  } @else {
                    <button class="edit-btn" (click)="startEdit(gov.id)">‚úèÔ∏è</button>
                    <button class="delete-btn" (click)="onDelete(gov.id)">üóëÔ∏è</button>
                  }
                </td>
              </tr>
            }
          </tbody>
        </table>
      }

      <!-- Loading State -->
      @if (isLoading) {
        <div class="loading">Loading governorates...</div>
      }

      <!-- No Data State -->
      @if (!isLoading && filteredGovernrates.length === 0) {
        <div class="no-data">
          No results found.
        </div>
      }
    </div>
