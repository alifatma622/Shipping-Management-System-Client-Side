<div class="add-delivery-man-container">
  <div class="header">
    <h2>Add Delivery Agent</h2>
  </div>

  <form [formGroup]="addForm" (ngSubmit)="onSubmit()" class="delivery-form" autocomplete="off">
    <div class="form-group">
      <label for="name">Name</label>
      <input id="name" formControlName="name" placeholder="Name" [class.invalid]="addForm.get('name')?.invalid && addForm.get('name')?.touched" />
      @if (addForm.get('name')?.invalid && addForm.get('name')?.touched) {
        <div class="error">
          Name is required (3-50 chars).
        </div>
      }
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <input id="email" formControlName="email" type="email" placeholder="Email" [class.invalid]="addForm.get('email')?.invalid && addForm.get('email')?.touched" />
      @if (addForm.get('email')?.invalid && addForm.get('email')?.touched) {
        <div class="error">
          Valid email is required.
        </div>
      }
    </div>

    <div class="form-group">
      <label for="userName">Username</label>
      <input id="userName" formControlName="userName" placeholder="Username" [class.invalid]="addForm.get('userName')?.invalid && addForm.get('userName')?.touched" />
      @if (addForm.get('userName')?.invalid && addForm.get('userName')?.touched) {
        <div class="error">
          Username is required (4-30 chars).
        </div>
      }
    </div>

    <div class="form-group">
      <label for="password">Password</label>
      <input id="password" formControlName="password" type="password" placeholder="Password" [class.invalid]="addForm.get('password')?.invalid && addForm.get('password')?.touched" />
      @if (addForm.get('password')?.invalid && addForm.get('password')?.touched) {
        <div class="error">
          Password must be at least 8 chars, include uppercase, lowercase, number, and symbol.
        </div>
      }
    </div>

    <div class="form-group">
      <label for="phoneNumber">Phone Number</label>
      <input id="phoneNumber" formControlName="phoneNumber" placeholder="Phone Number" [class.invalid]="addForm.get('phoneNumber')?.invalid && addForm.get('phoneNumber')?.touched" />
      @if (addForm.get('phoneNumber')?.invalid && addForm.get('phoneNumber')?.touched) {
        <div class="error">
          Valid Egyptian phone number required.
        </div>
      }
    </div>

    <div class="form-group">
      <label for="branchId">Branch</label>
      <select id="branchId" formControlName="branchId" [class.invalid]="addForm.get('branchId')?.invalid && addForm.get('branchId')?.touched">
        <option value="" disabled hidden>Select branch</option>
        @for (branch of branches; track branch) {
          <option [value]="branch.id">{{ branch.name }}</option>
        }
      </select>
      @if (addForm.get('branchId')?.invalid && addForm.get('branchId')?.touched) {
        <div class="error">
          Branch is required.
        </div>
      }
    </div>

    <div class="form-group">
      <label for="cityIds">Cities</label>
      <select id="cityIds" formControlName="cityIds" multiple [class.invalid]="addForm.get('cityIds')?.invalid && addForm.get('cityIds')?.touched">
        @for (city of cities; track city) {
          <option [value]="city.id">{{ city.name }}</option>
        }
      </select>
      @if (addForm.get('cityIds')?.invalid && addForm.get('cityIds')?.touched) {
        <div class="error">
          At least one city is required.
        </div>
      }
    </div>

    <div class="form-actions">
      <button class="add-btn" type="submit" [disabled]="addForm.invalid || isSubmitting">
        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
        Save
      </button>
    </div>

    @if (errorMsg) {
      <div class="error-msg">{{ errorMsg }}</div>
    }
    @if (successMsg) {
      <div class="success-msg">{{ successMsg }}</div>
    }
  </form>
</div>
